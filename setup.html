<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup - Basic Price Tracker</title>
    <meta name="description" content="Set up your personalized price tracking dashboard">
    <link rel="icon" type="image/x-icon" href="static/favicon.ico">
    <link rel="manifest" href="static/manifest.json">
    <link rel="stylesheet" href="static/style.css">
    <link rel="stylesheet" href="static/enhanced-styles.css">
</head>
<body>
    <div class="setup-container">
        <div class="setup-content">
            <div class="setup-header">
                <h1>üèÜ Welcome to Basic Price Tracker</h1>
                <p>Let's get you set up with personalized asset tracking</p>
                
                <div class="setup-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="progress-text" id="progressText">Step 1 of 3</div>
                </div>
            </div>
            
            <div class="setup-step active" id="step1">
                <h2>üëã Personal Information</h2>
                <div class="user-input">
                    <label for="userName">What's your name?</label>
                    <input type="text" id="userName" placeholder="Enter your name" required autocomplete="name">
                    <small>This will personalize your experience</small>
                </div>
                
                <div class="user-preferences">
                    <h3>Preferences</h3>
                    <label>
                        <input type="checkbox" id="enableNotifications" checked>
                        Enable browser notifications for price alerts
                    </label>
                    <label>
                        <input type="checkbox" id="enableSounds" checked>
                        Enable sound alerts
                    </label>
                    <label>
                        <select id="defaultTheme">
                            <option value="dark">Dark Theme</option>
                            <option value="light">Light Theme</option>
                            <option value="gold">Gold Theme</option>
                            <option value="blue">Blue Theme</option>
                        </select>
                        Default theme
                    </label>
                </div>
                
                <button class="btn-primary" onclick="nextStep()">Next Step ‚Üí</button>
            </div>
            
            <div class="setup-step" id="step2">
                <h2>üéØ Select Your Assets</h2>
                <p>Choose which assets you want to track (you can change this later):</p>
                
                <div class="selection-controls">
                    <button type="button" class="btn-secondary" onclick="selectPreset('conservative')">Conservative Portfolio</button>
                    <button type="button" class="btn-secondary" onclick="selectPreset('balanced')">Balanced Portfolio</button>
                    <button type="button" class="btn-secondary" onclick="selectPreset('aggressive')">Aggressive Portfolio</button>
                    <button type="button" class="btn-secondary" onclick="selectAll()">Select All</button>
                    <button type="button" class="btn-secondary" onclick="clearAll()">Clear All</button>
                </div>
            

            
            <div class="selection-grid">
                <div class="selection-category">
                    <h3>‚Çø Cryptocurrency</h3>
                    <label><input type="checkbox" value="btc" checked> Bitcoin (BTC)</label>
                    <label><input type="checkbox" value="eth"> Ethereum (ETH)</label>
                    <label><input type="checkbox" value="bnb"> Binance Coin (BNB)</label>
                    <label><input type="checkbox" value="ada"> Cardano (ADA)</label>
                    <label><input type="checkbox" value="sol"> Solana (SOL)</label>
                    <label><input type="checkbox" value="xrp"> Ripple (XRP)</label>
                    <label><input type="checkbox" value="dot"> Polkadot (DOT)</label>
                    <label><input type="checkbox" value="doge"> Dogecoin (DOGE)</label>
                    <label><input type="checkbox" value="avax"> Avalanche (AVAX)</label>
                    <label><input type="checkbox" value="matic"> Polygon (MATIC)</label>
                </div>
                
                <div class="selection-category">
                    <h3>ü•á Precious Metals</h3>
                    <label><input type="checkbox" value="gold" checked> Gold (XAU)</label>
                    <label><input type="checkbox" value="silver" checked> Silver (XAG)</label>
                    <label><input type="checkbox" value="platinum"> Platinum (XPT)</label>
                    <label><input type="checkbox" value="palladium"> Palladium (XPD)</label>
                </div>
                
                <div class="selection-category">
                    <h3>üí± Major Currencies</h3>
                    <label><input type="checkbox" value="usd_eur" checked> USD to EUR</label>
                    <label><input type="checkbox" value="usd_gbp"> USD to GBP</label>
                    <label><input type="checkbox" value="usd_jpy"> USD to JPY</label>
                    <label><input type="checkbox" value="usd_cad"> USD to CAD</label>
                    <label><input type="checkbox" value="usd_aud"> USD to AUD</label>
                    <label><input type="checkbox" value="usd_chf"> USD to CHF</label>
                    <label><input type="checkbox" value="usd_cny"> USD to CNY</label>
                    <label><input type="checkbox" value="usd_inr"> USD to INR</label>
                </div>
                
                <div class="selection-category">
                    <h3>üåç World Currencies</h3>
                    <label><input type="checkbox" value="usd_krw"> USD to KRW</label>
                    <label><input type="checkbox" value="usd_brl"> USD to BRL</label>
                    <label><input type="checkbox" value="usd_mxn"> USD to MXN</label>
                    <label><input type="checkbox" value="usd_rub"> USD to RUB</label>
                    <label><input type="checkbox" value="usd_try"> USD to TRY</label>
                    <label><input type="checkbox" value="usd_zar"> USD to ZAR</label>
                    <label><input type="checkbox" value="usd_nok"> USD to NOK</label>
                    <label><input type="checkbox" value="usd_sek"> USD to SEK</label>
                </div>
                
                <div class="selection-category">
                    <h3>üçî Big Mac Index</h3>
                    <label><input type="checkbox" value="bigmac_us" checked> USA</label>
                    <label><input type="checkbox" value="bigmac_uk"> United Kingdom</label>
                    <label><input type="checkbox" value="bigmac_jp"> Japan</label>
                    <label><input type="checkbox" value="bigmac_eu"> European Union</label>
                    <label><input type="checkbox" value="bigmac_ca"> Canada</label>
                </div>
            </div>
            
                <div class="step-actions">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                    <button class="btn-primary" onclick="nextStep()">Next Step ‚Üí</button>
                </div>
            </div>
            
            <div class="setup-step" id="step3">
                <h2>üöÄ Ready to Launch!</h2>
                <div class="setup-summary">
                    <h3>Setup Summary</h3>
                    <div class="summary-item">
                        <strong>Name:</strong> <span id="summaryName"></span>
                    </div>
                    <div class="summary-item">
                        <strong>Selected Assets:</strong> <span id="summaryAssets"></span>
                    </div>
                    <div class="summary-item">
                        <strong>Theme:</strong> <span id="summaryTheme"></span>
                    </div>
                    <div class="summary-item">
                        <strong>Notifications:</strong> <span id="summaryNotifications"></span>
                    </div>
                </div>
                
                <div class="setup-features">
                    <h3>What you'll get:</h3>
                    <ul>
                        <li>‚úÖ Real-time price updates</li>
                        <li>‚úÖ Advanced analytics and charts</li>
                        <li>‚úÖ Price alerts and notifications</li>
                        <li>‚úÖ Portfolio tracking</li>
                        <li>‚úÖ Historical data analysis</li>
                        <li>‚úÖ Offline support (PWA)</li>
                    </ul>
                </div>
                
                <div class="step-actions">
                    <button class="btn-secondary" onclick="prevStep()">‚Üê Previous</button>
                    <button id="startTrackingBtn" class="btn-primary btn-large">üöÄ Start Tracking</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 3;
        
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Step ${currentStep} of ${totalSteps}`;
        }
        
        function showStep(step) {
            document.querySelectorAll('.setup-step').forEach(s => s.classList.remove('active'));
            document.getElementById(`step${step}`).classList.add('active');
            updateProgress();
            
            if (step === 3) {
                updateSummary();
            }
        }
        
        function nextStep() {
            if (currentStep === 1) {
                const userName = document.getElementById('userName').value.trim();
                if (!userName) {
                    alert('Please enter your name.');
                    return;
                }
            }
            
            if (currentStep === 2) {
                const selectedAssets = getSelectedAssets();
                if (selectedAssets.length === 0) {
                    alert('Please select at least one asset to track.');
                    return;
                }
            }
            
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        }
        
        function prevStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        }
        
        function getSelectedAssets() {
            const checkboxes = document.querySelectorAll('.selection-category input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }
        
        function selectPreset(type) {
            clearAll();
            
            const presets = {
                conservative: ['btc', 'gold', 'silver', 'usd_eur'],
                balanced: ['btc', 'eth', 'gold', 'silver', 'usd_eur', 'usd_gbp', 'bigmac_us'],
                aggressive: ['btc', 'eth', 'bnb', 'ada', 'sol', 'xrp', 'dot', 'doge', 'avax', 'matic']
            };
            
            const assets = presets[type] || [];
            assets.forEach(asset => {
                const checkbox = document.querySelector(`input[value="${asset}"]`);
                if (checkbox) checkbox.checked = true;
            });
        }
        
        function selectAll() {
            document.querySelectorAll('.selection-category input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
            });
        }
        
        function clearAll() {
            document.querySelectorAll('.selection-category input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
        }
        
        function updateSummary() {
            const userName = document.getElementById('userName').value.trim();
            const selectedAssets = getSelectedAssets();
            const theme = document.getElementById('defaultTheme').value;
            const notifications = document.getElementById('enableNotifications').checked;
            
            document.getElementById('summaryName').textContent = userName;
            document.getElementById('summaryAssets').textContent = `${selectedAssets.length} assets selected`;
            document.getElementById('summaryTheme').textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
            document.getElementById('summaryNotifications').textContent = notifications ? 'Enabled' : 'Disabled';
        }
        
        document.getElementById('startTrackingBtn').onclick = function() {
            const userName = document.getElementById('userName').value.trim();
            const selectedAssets = getSelectedAssets();
            const theme = document.getElementById('defaultTheme').value;
            const enableNotifications = document.getElementById('enableNotifications').checked;
            const enableSounds = document.getElementById('enableSounds').checked;
            
            if (!userName || selectedAssets.length === 0) {
                alert('Please complete all setup steps.');
                return;
            }
            
            // Show loading state
            const btn = document.getElementById('startTrackingBtn');
            btn.innerHTML = '‚è≥ Setting up...';
            btn.disabled = true;
            
            // Save preferences
            const preferences = {
                theme,
                enableNotifications,
                enableSounds,
                setupDate: new Date().toISOString()
            };
            
            // Try multiple storage methods for cross-browser compatibility
            try {
                // Method 1: localStorage
                localStorage.setItem('userName', userName);
                localStorage.setItem('userSelectedAssets', JSON.stringify(selectedAssets));
                localStorage.setItem('setupComplete', 'true');
                localStorage.setItem('userPreferences', JSON.stringify(preferences));
                localStorage.setItem('selectedTheme', theme);
                
                // Method 2: sessionStorage as backup
                sessionStorage.setItem('userName', userName);
                sessionStorage.setItem('userSelectedAssets', JSON.stringify(selectedAssets));
                sessionStorage.setItem('setupComplete', 'true');
                sessionStorage.setItem('userPreferences', JSON.stringify(preferences));
                
                console.log('Data saved, redirecting...');
                
                // Use URL parameters as additional backup
                const params = new URLSearchParams();
                params.set('user', encodeURIComponent(userName));
                params.set('assets', encodeURIComponent(JSON.stringify(selectedAssets)));
                params.set('setup', 'true');
                
                setTimeout(() => {
                    window.location.href = 'index.html?' + params.toString();
                }, 1000);
                
            } catch (error) {
                console.error('Storage error:', error);
                // Fallback to URL only
                const params = new URLSearchParams();
                params.set('user', encodeURIComponent(userName));
                params.set('assets', encodeURIComponent(JSON.stringify(selectedAssets)));
                params.set('setup', 'true');
                
                setTimeout(() => {
                    window.location.href = 'index.html?' + params.toString();
                }, 1000);
            }
        };
        
        // Initialize
        updateProgress();
        
        // Auto-detect system theme
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
            document.getElementById('defaultTheme').value = 'light';
        }
    </script>
    
    <script src="static/core.js"></script>
    <script>
        // Initialize coin animation on setup page
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                try {
                    new CoinAnimation();
                } catch (error) {
                    console.warn('Animation failed to load:', error);
                }
            });
        } else {
            try {
                new CoinAnimation();
            } catch (error) {
                console.warn('Animation failed to load:', error);
            }
        }
        
        // Request notification permission during setup
        if ('Notification' in window && Notification.permission === 'default') {
            document.getElementById('enableNotifications').addEventListener('change', function() {
                if (this.checked) {
                    Notification.requestPermission();
                }
            });
        }
    </script>
    
    <!-- Help tooltip -->
    <div class="help-tooltip" id="helpTooltip" style="display: none;">
        <div class="tooltip-content">
            <h4>Need Help?</h4>
            <p>This setup wizard will help you configure your personalized price tracking dashboard.</p>
            <ul>
                <li><strong>Step 1:</strong> Enter your name and preferences</li>
                <li><strong>Step 2:</strong> Select assets to track</li>
                <li><strong>Step 3:</strong> Review and launch</li>
            </ul>
            <button onclick="hideHelp()">Got it!</button>
        </div>
    </div>
    
    <button class="help-button" onclick="showHelp()" title="Show help">?</button>
    
    <script>
        function showHelp() {
            document.getElementById('helpTooltip').style.display = 'flex';
        }
        
        function hideHelp() {
            document.getElementById('helpTooltip').style.display = 'none';
        }
    </script>
</body>
</html>